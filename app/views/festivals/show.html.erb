<%# Display one festival schedule: /festivals/1 -%>
<% content_for :title do %>Schedule for <%= @festival.name %><% end %>
<% content_for :header do %>
  <%= render :partial => "festivals/header", :locals => { :festival => @festival, :hide_tabs => conference_mode } %>
<% end %>
<% content_for :additional_stylesheets do %>
  <%= stylesheet_link_tag 'daygrid', :media => 'screen, print' %>
<% end %>

<% cache @cache_key do %>
<div class="instructions">
<% if logged_in? %>

<% if conference_mode %>
<p>The conference schedule is below; you can click individual sessions to select or unselect them.
When you select a session, conflicting sessions will be unselected for you.</p>

<p>Also:</p>
<ul class="legend">
<li>During the conference, the list starts with today's date; older days appear at the end.</li>
<li>You can click <%= link_to_remote "here",
   :url => reset_screenings_festival_url(@festival),
   :method => :post,
   :confirm => "Are you sure you want to unschedule all your sessions?" %>
to reset all your selected sessions and start over.</li>
<li>You can also <%= link_to 'download your schedule in iCalendar format', poly_formatted_festival_path(@festival, 'ical') %>.</li>
<li>If you print this page in your browser, we'll leave off these instructions and just show the schedule stuff; the format and pagination are bit rough at the moment, but it'll be better soon.</li>
</ul>
<% else %>
<p>The festival schedule is below; you can click individual screenings to select or unselect them.
When you select a screening, conflicting screenings and other screenings of that film will be unselected
for you.</p>

<p>While manually selecting each screening works fine, we can do better: if you switch to the Films 
tab above, you can set your personal priority for seeing each film. Once you've done that, we'll try 
to automatically select screenings of your higher-priority films.</p>

<p>Here's what the colors mean:</p>
<ul class="legend">
<li><span class="scheduled">a screening you've selected;</span> you're going to this screening.</li>
<li><span class="otherscheduled">a screening of a film you've selected to see at another time;</span> you're going to a different screening of this film.</li>
<li><span class="unscheduled">a screening of a film you've prioritized, but haven't scheduled;</span> you want to see this film, but haven't picked a screening yet.</li>
<li><span class="unranked">a screening of a film you've prioritized at the lowest setting, or haven't prioritized;</span> you're not planning on seeing this film.</li>
<li>The priority you gave each film (on the Films page) is shown with little circles: 
      <%= image_tag "priority/p3.png", :height => 10, :width => 46 %></li>
</ul>

<p>Also:</p>
<ul class="legend">
<li>During the festival, the list starts with today's screenings; older days appear at the end.</li>
<li>You can click <%= link_to_remote "here",
   :url => reset_screenings_festival_url(@festival),
   :method => :post,
   :confirm => "Are you sure you want to unschedule all your screenings?" %> 
to reset all your selected screenings and start over<% if RAILS_ENV == "development" %>, or 
<%= link_to "here", 
            poly_schedule_festival_path(@festival),
            :method => :post %> to auto-schedule more prioritized screenings<% end %>.</li>
<li>You can also <%= link_to 'download your scheduled films in iCalendar format', poly_formatted_festival_path(@festival, 'ical') %>.</li>
<li>If you print this page in your browser, we'll leave off these instructions and just show the schedule stuff; the format and pagination are bit rough at the moment, but it'll be better soon.</li>
</ul>
<% end %><%# festival mode %>

<% else %><%# not logged in %>
<p>Here's the <%= _[:festival] %> schedule; if you log in, you'll be able to click on the grid to schedule 
<%= conference_mode ? "sessions" : "screenings" %>.</p>
<% end %>
</div>

<div id="days" class="days">
  <%= render :partial => "day", 
             :collection => days(@festival, conference_mode) %>
</div>
<% end # caching -%>

<% content_for("page_scripts") do %>
jQuery(function() {
  // Apply picks for this user
  <%= @screening_javascript %>

  <% if logged_in? -%>
  // Register for clicks on all our screenings
  jQuery(".screening").click(function(e) {
    jQuery.post('<%= pick_screening_festival_path(@festival) %>',
                { 'screening_id': this.id.split('-')[1],
                  'state': this.hasClassName('scheduled')
                           ? 'unpicked' : 'picked' },
                function (script) { eval(script); })
  });
  <% end -%>
});
<% end -%>

